
<html>
<head>
    <title>Get PGN with linebreaks. Bibimnews Tools</title>
    <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
    <script
    src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
    integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/ui-lightness/jquery-ui.css"/>
  <link rel="stylesheet" href="/css/default.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
  <style type="text/css">


    .dochange_button{
        width:90%;
        height:100px;
        clear: both;
        margin-left:5%;
        margin-right:5%;
        margin-top:20px;
        margin-bottom:20px;        
    }
    .textarea_gibo{
        width:100%;
        clear:both;
    }
  </style>
  <script type="text/javascript">
    function doRun(){
        $('#dochange').click(function(){
            let before = getBefore();
            //console.log('before=' + before);
            let after = doTransform(before);
            setAfter(after);
            setAfterLi(after);
        });
    }

    function getBefore(){
        return $('#before').val();
    }    

    function doTransform(before){
        let after = [];
        
        let bracketStart = 0;
        let bracketEnd = 0;        

        //괄호 안 내용 없애기
        for(let i = 0 ; i < before.length ; i++){
            if(before.charAt(i) == '('){
                after.push(before.slice(bracketEnd, i).split());
                bracketStart = i;
            }
            if(before.charAt(i) == ')'){
                bracketEnd = i + 1;
            }
        }
        after.push(before.slice(bracketEnd, before.length).split());

        //let reBracket = /[(].*(?:(?![(]))[)]/g;
        //let afterstr = before.replaceAll(reBracket, '');

        let afterstr = after.join('');
        after = [];

        let re = /[0-9]+[.]+[ ]/g;
        afterstr = afterstr.replaceAll(re, '\n'+'$&');
 
        return afterstr;
    }

    function setAfter(after){
        $('#after').val(after);
        $('#after').select();
        document.execCommand('copy');
    }

    function setAfterLi(after){
        const arr = after.split('\n');
        const arrli = arr.map(item => !item.startsWith('[') && item != '' && item != null ? '<li>' + item + '</li>' : item);

        const afterli = arrli.join('\n');
        $('#afterli').val(afterli);

        $('#afterli').select();
        document.execCommand('copy');
    }

    $(document).ready(function(){
        doRun();
    });
    </script>
</head>
<body>
    <%-include('menu') %>
    <canvas id="canvas" style="display:none"></canvas>
    <h1>Get PGN with linebreaks.</h1>
    <h2>1. Insert PGN Here</h2>
    <textarea id="before" name="before" class="textarea_gibo" cols="150" rows="15"></textarea> 
    <h2>2. Click to convert</h2>
    <button name="dochange" id="dochange" class="dochange_button">변환</button>
    <h2>3. Converted PGN with linebreaks</h2>
    <textarea id="after" name="after"  class="textarea_gibo" cols="150" rows="15"></textarea>
    <h2>4. Converted PGN with li tags</h2>
    <textarea id="afterli" name="afterli"  class="textarea_gibo" cols="150" rows="15"></textarea>
</body>
</html>



